---
layout: document
category: Development
published: true
title: Core callbacks reference
description: This comprehensive reference provides detailed information about all callbacks used in Textpattern.
---

# Core callbacks reference

This comprehensive reference provides detailed information about all callbacks used in Textpattern, including their [events and steps](https://docs.textpattern.io/development/admin-side-events-and-steps).

On this page:

* [Public-side callbacks](#public-side-callbacks)
* [Admin-side callbacks](#admin-side-callbacks)
  * [Major block-level callbacks](#major-block-level-callbacks)
  * [Widget callbacks](#widget-callbacks)
  * [Panel-level callbacks](#panel-level-callbacks)
  * [Admin-side criteria callbacks](#admin-side-criteria-callbacks)
  * [Admin-side validation callbacks](#admin-side-validation-callbacks)
  * [Admin-side theme callbacks](#admin-side-theme-callbacks)
* [Plugin callbacks](#plugin-callbacks)
* [Function- and tag-based callbacks](#function-and-tag-based-callbacks)

## Public-side callbacks

These all trigger at various points during the rendering of publicly viewable content served by Textpattern. Use them to inject content - JavaScript, CSS or HTML - into the page or to alter various facets of visitor interaction with the site. They have *events*, but no *steps*.

### publish.php

The callbacks in this section all deal with the web page content itself.

`pretext`
* **When it occurs:** At the very top of the `pretext()` function, just after the prefs have been extracted.
* **What it allows:** Injection/alteration of variables in the prefs array or to set up anything that affects the whole page.

`pretext_end`
* **When it occurs:** Just after `pretext()` has run but before its variables have been extracted into the global scope.
* **What it allows:** Altering anything set in `pretext()` or adding variables to it.

`file_download`
* **When it occurs:** As soon as a `file_download` is detected.
* **What it does:** Intercepts the regular file downloading process.

`textpattern`
* **When it occurs:** Just before the page is rendered.

`textpattern_end`
* **When it occurs:** Once the page has been fully rendered.
* **What it allows:** Replacement of content in the output buffer via search/replace.

### publish/atom.php

If you wish to alter atom feeds, these callbacks will help.

`atom_head`
* **When it occurs:** After the feed's header has been set.
* **What it allows:** Adding items to the Atom feed's header.

`atom_entry`
* **When it occurs:** As soon as the article's data has been populated.
* **What it allows:** Injection of extra markup after the standard Atom feed items have been generated.

### publish/rss.php

If you wish to alter rss feeds, these callbacks will help.

`rss_head`
* **When it occurs:** After the feed's header has been set.
* **What it allows:** Adding items to the RSS feed's header.

`rss_entry`
* **When it occurs:** As soon as the article's data has been populated.
* **What it allows:** Injection of extra markup after the standard RSS feed items have been generated.

### publish/comment.php

Any time a comment form is rendered or a comment is posted on an article, the following callbacks fire, so use them to intercept or alter comment layout/payloads.

`comment.form`
* **When it occurs:** At the end of the `commentForm()` function.
* **What it allows:** Injection of markup after the textarea generated by the `<txp:comment_message_input />` tag.

`comment.save`
* **When it occurs:** Just before a comment is posted.
* **What it allows:** Additional decisions to be made, based on the comment content (e.g. for anti-spam plugins).

`comment.saved`
* **When it occurs:** Just after a comment is posted to the database.
* **What it allows:** Additional processing that might affect other related tables. Argument \#3 is an array of name-value pairs containing the message *text*, *name*, *email*, *web*, *parentid*, *commentid*, *ip*, and visible status of the posted comment.

### publish/log.php

As long as *Logging* is switched on from the [Preferences panel](https://docs.textpattern.io/administration/preferences-panel), whenever a visitor requests a web page from Textpattern, a hit is registered. Use the callback here to intercept it.

`log_hit`
* **When it occurs:** Just before a log message is recorded in the 'txp_log' table.
* **What it allows:** Alteration of the log message.

## Admin-side callbacks

Admin-side callbacks are split into three flavours. The first are easy to recognize from the address bar of your browser. If you select any admin-side panel link, you'll see the URL contains `?event=panelname`, and if you select any link in that panel that performs an action, you'll see `?event=panelname&step=action`. Those values correspond to the `$event` and `$step` parameters you can use during [plugin or theme development](https://docs.textpattern.io/development/). In fact, they will call any user-defined function that is registered for said `$event` and `$step`, allowing you to add your own *events* and *steps* as you need them.

If you wish to utilise such core hooks, consult the [admin-side events and steps](https://docs.textpattern.io/development/admin-side-events-and-steps) document, which lists them all.

The second type of callback relate to actions that occur in response to various page-level signals. These could be when certain parts of the administration interface are rendered or when actions (such as deletion) complete, and are listed below.

The final type of callback is `pluggable_ui()`. These deal with specific chunks of content that appear on the page and allow direct manipulation of individual elements or blocks. They are listed in the [pluggable_ui](https://docs.textpattern.io/development/the-pluggable-ui-function) document.

### Major block-level callbacks

These callbacks relate to the `<head>` and `<footer>` sections, and navigation area of each admin panel. Raising callbacks on these `event > step` combinations will call your plugin on _every_ panel. Check the global `$event` if you only wish to target a specific panel.

`admin_side > head_end`
* **When it occurs:** Just before the closing `</head>` tag on every admin-side panel.
* **What it allows:** Injecting JavaScript or style rules into the page's header.

`admin_side > pagetop`
* **When it occurs:** Immediately before control is handed to the theme.
* **What it does:** Renders the navigation bar.

`admin_side > pagetop_end`
* **When it occurs:** Immediately after the theme has been loaded and its header rendered. Just before the closing `</header>` tag.
* **What it allows:** Injection of admin-wide markup below the panel navigation area.

`admin_side > main_content`
* **When it occurs:** Immediately after the 'announce' area (where feedback messages appear) and before the panel's main content begins. Just inside the `<main>` tag.
* **What it allows:** Addition of information at the top of any panel, below the navigation area.

`admin_side > main_content_end`
* **When it occurs:** Immediately before the closing `</main>` tag at the bottom of the panel.
* **What it allows:** Addition of information at the bottom of any panel, above the footer area.

`admin_side > body_end`
* **When it occurs:** After the theme's footer has been rendered, before the closing `</body>` tag.
* **What it allows:** Injection of non-blocking JavaScript `<script>` tags.

### Widget callbacks

These callbacks are raised when input elements or constructs are rendered. They allow you to target input controls such as multi-edit options, pagination widgets, etc.

`{event}_ui > multi_edit_options`
* **When it occurs:** Whenever a list of multi-edit options is rendered. The `{event}` is the panel on which the multi-edit control appears.
* **What it allows:** Alteration or augmentation of the multi-edit select list. Argument \#3 contains the options array, passed by reference so it may be altered directly.

`{event}_ui > pageby_values`
* **When it occurs:** Whenever a set of pagination options are rendered. The `{event}` is the panel on which the pagination options appear.
* **What it allows:** Alteration or augmentation of the steps in which pagination may occur, i.e. how many 'rows' of data are shown per page.
* **Argument \#3:** The array of sizes, passed by reference so it may be altered directly.

### Panel-level callbacks
#### Write panel

`article_posted`
* **When it occurs:** Immediately after article creation.
* **What it allows:** Interception of the article create process to append or prepend content to the record, or to perform some additional processing.
* **Additional parameter:** The posted contents as an array.

`article_saved`
* **When it occurs:** Immediately after article update/save.
* **What it allows:** Interception of the article save process to append or prepend content to the record, or to perform some additional processing.
* **Additional parameter:** The posted contents as an array.

`ping`
* **When it occurs:** Just before a ping notification is sent upon publication of an article.
* **What it allows:** Interception of the ping so you can provide your own.

`article_ui > partials_meta`
* **When it occurs:** Just before the partials are refreshed on an Ajax save.
* **What it allows:** Alter or augment the interface, usually based on the data sent to/from the Ajax save process.
* **Argument \#3:** The record set of the article being edited.
* **Argument \#4:** The partials array comprised of:
  * **key:** Unique name of the item available to alter, then an array as follows:
    * **mode:** The mechanism by which the partial may be updated
    * **selector:** The wholly encapsulated DOM selector to which the partial applies
    * **callback** The callback function to utilize to update the nominated part of the interface
    * **html** An optional return value of the callback function

#### Articles panel

`articles_deleted`
* **When it occurs:** After one or more articles have been deleted and any associated comments have had their visibility removed.
* **What it allows:** To do any additional cleanup after one or more articles are removed from Textpattern.
* **Additional parameter:** An array of deleted article IDs.

#### Categories panel

`categories_deleted`
* **When it occurs:** After one or more categories have been deleted and the tree has been rebuilt.
* **What it allows:** To do any additional cleanup after one or more categories are removed from Textpattern.
* **Additional parameter:** An array of deleted category IDs.

#### Images panel

`image_deleted`
* **When it occurs:** Before an image and its thumbnail are deleted.
* **What it allows:** To do any additional cleanup after one or more images are removed from Textpattern.
* **Additional parameter:** The ID of the deleted image.

`thumbnail_deleted`
* **When it occurs:** Before a thumbnail is deleted.
* **What it allows:** To do any additional cleanup after a thumbnail is removed from Textpattern.
* **Additional parameter:** The ID of the deleted thumbnail.

`image_uploaded`
* **When it occurs:** After an image has been uploaded or replaced by another image.
* **What it allows:** To do any additional processing after an image is added or replaced from Textpattern.
* **Additional parameter:** The ID of the image.

#### Files panel

`file_deleted`
* **When it occurs:** Before each file is deleted.
* **What it allows:** To do any additional cleanup after one or more files are removed from Textpattern.
* **First additional parameter:** The file ID of the deleted file.
* **Second additional parameter:** The full path to the deleted file.

#### Links panel

`links_deleted`
* **When it occurs:** After one or more links have been deleted.
* **What it allows:** To do any additional cleanup after one or more links are removed from Textpattern.
* **Additional parameter:** An array of deleted link IDs.

#### Comments panel

`discuss_deleted`
* **When it occurs:** After one or more comments have been deleted, but _before_ the comment counts have been updated in the affected articles.
* **What it allows:** To do any additional cleanup after one or more comments are removed from Textpattern.
* **Additional parameter:** An array of deleted comment IDs.

#### Sections panel

`sections_deleted`
* **When it occurs:** After one or more sections have been deleted.
* **What it allows:** To do any additional cleanup after one or more sections are removed from Textpattern.
* **Additional parameter:** An array of deleted section names.

#### Pages panel

`page_deleted`
* **When it occurs:** After a page template has been deleted.
* **What it allows:** To do any additional cleanup after a page template is removed from Textpattern.
* **Additional parameter:** The name of the deleted page.

#### Forms panel

`forms_deleted`
* **When it occurs:** After one or more forms have been deleted.
* **What it allows:** To do any additional cleanup after one or more forms are removed from Textpattern.
* **Additional parameter:** An array of deleted form names.

#### Styles panel

`css_deleted`
* **When it occurs:** After a stylesheet has been deleted.
* **What it allows:** To do any additional cleanup after a stylesheet is removed from Textpattern.
* **Additional parameter:** The name of the deleted stylesheet.

#### Diagnostics panel

`diag_results > low` or `> high`
* **When it occurs:** At the end of the `doDiagnostics()` function that renders the content of the [Diagnostics](https://docs.textpattern.io/administration/diagnostics-panel) panel.
* **What it allows:** To add any extra information to the diagnostic output depending on the level of output the user has chosen (high or low).

#### Users panel

`authors_deleted`
* **When it occurs:** After user(s) have been deleted and all assets have been reassigned.
* **What it allows:** To do any additional cleanup after a user is removed from Textpattern.
* **Additional parameter:** An array of deleted user names.

### Admin-side criteria callbacks

These callbacks allow you to alter the criteria used in the various panels. You can append SQL to the criteria to apply additional
filtering.

Note the criteria is *appended*, so existing search parameters are honoured. Therefore your returned statement should begin with
`" AND ..."`. If you wish to ignore any previous filtering, begin `" AND 1 AND ..."`.

The third argument to your callback function contains the current criteria used, so you may make decisions based on its contents (e.g. you may not want to filter the results if a search has been performed).

These callbacks all have the same `$event` called `admin_criteria`.

Panel | `$step`
---|---
[Articles](https://docs.textpattern.io/administration/articles-panel) | `list_list`
[Comments](https://docs.textpattern.io/administration/comments-panel) | `discuss_list`
[Files](https://docs.textpattern.io/administration/files-panel) | `file_list`
[Forms](https://docs.textpattern.io/administration/forms-panel) | `form_list`
[Images](https://docs.textpattern.io/administration/images-panel) | `image_list`
[Links](https://docs.textpattern.io/administration/links-panel) | `link_list`
[Pages](https://docs.textpattern.io/administration/pages-panel) | `page_list`
[Sections](https://docs.textpattern.io/administration/sections-panel) | `section_list`
[Styles](https://docs.textpattern.io/administration/styles-panel) | `css_list`
[Themes](https://docs.textpattern.io/administration/themes-panel) | `skin_list`
[Users](https://docs.textpattern.io/administration/users-panel) | `author_list`
[Visitor logs](https://docs.textpattern.io/administration/visitor-logs-panel) | `log_list`

### Admin-side validation callbacks

These callbacks allow you to alter or append to the constraints imposed by the core when saving data. Textpattern will check that the passed values for things like categories, sections, and so forth actually exist in the database to avoid new ones being introduced at unexpected places.

If you're developing plugins, you may wish to open up or restrict data in certain types of actions, or create entirely new constraints and take advantage of the built-in validator. If so, these callbacks are the ones to use.

These additional arguments are all passed by reference to your application, so you can alter them directly:

-   Argument \#3 is the incoming array of values posted from the save operation, unsanitized.
-   Argument \#4 is the array of constraints.

Panel | `$event` | `$step`
---|---|---
[Articles](https://docs.textpattern.io/administration/content/articles-panel) | `article_ui` | `validate_save`
[Articles](https://docs.textpattern.io/administration/content/articles-panel) | `article_ui` | `validate_publish`
[Comments](https://docs.textpattern.io/administration/content/comments-panel) | `discuss_ui` | `validate_save`
[Files](https://docs.textpattern.io/administration/content/files-panel)       | `file_ui`    | `validate_save`
[Images](https://docs.textpattern.io/administration/content/images-panel)     | `image_ui`   | `validate_save`
[Links](https://docs.textpattern.io/administration/content/links-panel)       | `link_ui`    | `validate_save`

### Plugin callbacks

In order to process these callbacks, your plugin must raise the `PLUGIN_LIFECYCLE_NOTIFY` flag to register its intent. In addition, if
you wish to offer a link to your plugin's preferences from the [Plugins](http:docs.textpattern.io/administration/plugins-panel) panel, you must raise the `PLUGIN_HAS_PREFS` flag.

`$event` | `$step` | When it occurs
---|---|---
`plugin_lifecycle.abc_your_plugin` | `enabled`   | When somebody switches abc_your_plugin to "Enabled" (Yes) from the **Plugins** panel.
`plugin_lifecycle.abc_your_plugin` | `disabled`  | When somebody switches abc_your_plugin to "Disabled" (No) on the **Plugins** panel.
`plugin_lifecycle.abc_your_plugin` | `installed` | When abc_your_plugin has been installed by the act of the user pasting its code in the **Plugins** panel and selecting **Install** button on the next screen.
`plugin_lifecycle.abc_your_plugin` | `deleted`   | When abc_your_plugin has been removed by the act of a user selecting it and deleting it from the **Plugins** panel (note that the `plugin_lifecycle.abc_your_plugin` / `disabled` callback fires first).

### Function- and tag-based callbacks

In `lib/txplib_misc.php` there are some callbacks that allow you to modify the default behaviour of some of the core functions. These are listed below:

`$event` | `$step` | When/where it occurs | What it allows/does
---|---|---|---
`sanitize_for_url`  | - | At start of the `sanitizeForUrl()` function. | Apply your own URL sanitization rules; passes the text to be sanitized as the callback's 4th argument.
`sanitize_for_file` | - | At start of the `sanitizeForUrl()` function. | Apply your own filename sanitization rules; passes the text to be sanitized as the callback's 4th argument.
`sanitize_for_page` | - | At start of the `sanitizeForPage()` function | Apply your own page name sanitization rules; passes the text to be sanitized as the callback's 4th argument.
`txp_die` |`http_status_code` | Once the page's HTTP status has been determined. | Passes the numerical HTTP status code as the callback's *step* (e.g. `410`, `301`, etc) allowing you to target particular status codes and take action.
