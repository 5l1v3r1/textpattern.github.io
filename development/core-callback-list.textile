---
layout: document
category: development
published: true
title: "Core callbacks list"
tags:
  - development 
  - plugins
  - callbacks
  - core
---

h1. Core callbacks list

This is a reference of all callbacks used in Textpattern.

On this page:

* "Regular public-side callbacks":#sec1
* "Function- and tag-based callbacks":#sec2
* "Plugin callbacks":#sec3
* "Regular admin-side callbacks":#sec4
* "Admin-side criteria callbacks":#sec5
* "Admin-side validation callbacks":#sec6
* "@pluggable_ui()@ callbacks":#sec7
* "Theme callbacks":#sec8

h2(#sec1). Regular public-side callbacks

[todo:intro line about regular callbacks]

h3. __publish.php__

There are no _steps_ for this callback.

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">
	
|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @pretext@ | - | At the very top of the  @pretext()@ function, just after the prefs have been extracted. | - |
| @pretext_end@ | - | Just after @pretext()@ has run but before its variables have been extracted into the global scope. | Overrides anything set in @pretext()@ or adds variables to it. |
| @file_download@ | - | As soon as a @file_download@ is detected. | Intercepts the regular file downloading process. |
| @textpattern@ | - | Just before the page is rendered. | - |
| @textpattern_end@ | - | Once the page has been fully rendered. | - |

notextile. </div>

h3. __publish/atom.php__

There are no _steps_ for this callback.

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @atom_head@ | - | After the feed's header has been set. | Adds items to the feed's header. |
| @atom_entry@ | - | As soon as the article's data has been populated. | Injects extra markup after the standard feed items have been generated. |

notextile. </div>

h3. __publish/rss.php__

There are no _steps_ for this callback.

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @rss_head@ | - | After the feed's header has been set. | Adds items to the feed's header. |
| @rss_entry@ | - | As soon as the article's data has been populated. | Injects extra markup after the standard feed items have been generated. |

notextile. </div>

h3. __publish/comment.php__

There are no _steps_ for this callback.

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When/where it occurs |_. What it allows/does |
| @comment.form@ | - | At the end of the @commentForm()@ function. | Injects markup after the textarea generated by the @<txp:comment_message_input. />@ |
| @comment.save@ | - | Just before a comment is posted. | Makes additional decisions based on the comment content (e.g. anti-spam plugins). |
| @comment.saved@ | - | Just after a comment is posted to the database. | Argument #3 is an array of name-value pairs containing the message _text_, _name_, _email_, _web_, _parentid_, _commentid_, _ip_, and visible status of the posted comment. |

notextile. </div>

h3. __publish/log.php__

There are no _steps_ for this callback.

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @log_hit@ | - | Just before a log message is recorded in the @txp_log@ table. | Alters the log message. |

notextile. </div>

h2(#sec2). Function- and tag-based callbacks

**_lib/txplib_misc.php_**

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When/where it occurs |_. What it allows/does |
| @sanitize_for_url@ | - | At start of the @sanitizeForUrl()@ function. | Apply your own URL sanitization rules; passes the text to be sanitized as the callback's 4th argument. |
| @sanitize_for_file@ | - | At start of the @sanitizeForUrl()@ function. | Apply your own filename sanitization rules; passes the text to be sanitized as the callback's 4th argument. |
| @sanitize_for_page@ | - | At start of the @sanitizeForUrl()@ function. | Apply your own page name sanitization rules; passes the text to be sanitized as the callback's 4th argument. |
| @txp_die@ | @http_status_code@ | Once the page's HTTP status has been determined. | Passes the numerical HTTP status code as the callback's _step_ (e.g., @410@, @301@, etc) allowing you to target particular status codes and take action. |

notextile. </div>

h2(#sec3). Plugin callbacks

**_include/txp_plugin.php_**

In order to process these callbacks, your plugin must raise the @PLUGIN_LIFECYCLE_NOTIFY@ flag to register its intent. In addition, if you wish to offer a link to your plugin's preferences from the  **"Plugins":http:docs.textpattern.io/administration/plugins-panel** panel, you must raise the @PLUGIN_HAS_PREFS@ flag.

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @plugin_lifecycle.abc_your_plugin@ | @enabled@ | When somebody switches abc_your_plugin to "Enabled" (Yes) from the **Plugins** panel. | - |
| @plugin_lifecycle.abc_your_plugin@ | @disabled@ | When somebody switches abc_your_plugin to "Disabled" (No) on the **Plugins** panel. | - |
| @plugin_lifecycle.abc_your_plugin@ | @installed@ | When abc_your_plugin has been installed by the act of the user pasting its code in the **Plugins** panel and clicking **Install** button on the next screen. | - |
| @plugin_lifecycle.abc_your_plugin@ | @deleted@ | When abc_your_plugin has been removed by the act of a user selecting it and deleting it from the **Plugins** panel (note that the @plugin_lifecycle.abc_your_plugin@ / @disabled@ callback fires first). | - |

notextile. </div>

h2(#sec4). Regular admin-side callbacks

**_lib/txplib_head.php_**

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @admin_side@ | @head_end@ | Just before the closing @</head>@ tag on every admin-side panel. | For injecting JavaScript or style rules into the page's header. |
| @admin_side@ | @pagetop@ | Immediately before control is handed to the theme. | Renders the navigation bar. |
| @admin_side@ | @pagetop_end@ | Immediately after the theme has finished. | Rendering the navigation bar useful for adding admin-wide markup below @pagetop@. |

notextile. </div>

**_lib/txplib_html.php_**

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @admin_side@ | @body_end@ | Once the theme has rendered its footer. | Tacks on any extra admin-wide information immediately before the closing @</body>@ tag. |
| @some_event_ui@ | @multi_edit_options@ | - | Alters or augments the multi-edit select list; argument #3 contains the options array which is passed by reference so it may be altered directly. |

notextile. </div>

**_include/txp_article.php_**

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @article_posted@ | - | Immediately after article creation. | - |
| @article_saved@ | - | Immediately after article update/save. | - |
| ping | - | Just before a ping notification is sent upon publication of an article. | You may intercept the ping and provide your own. |
| @article_ui@ | @partials_meta@ | - | Alters or augments the interface, usually based on the data sent to/from the AJAX save process. Argument #3 is the record set of the article being edited. Argument #4 is the partials array comprised of a *_key_* (unique name of the item available to alter), then an array: *_mode_* (the mechanism by which the partial may be updated), *_selector_* (the wholly encapsulated DOM selector to which the partial applies), *_callback_* (the callback function to utilise to update the nominated part of the interface), and *_html_* (an optional return value of the callback function). |

notextile. </div>

**_include/txp_diag.php_**

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @diag_results@ | @high@ or @low@ | At the end of the @doDiagnostics()@ function. | Renders the content of the **"Diagnostics":http://docs.textpattern.io/administration/admin/diagnostics-panel** panel. Allows you to add any extra information to the diagnostic output depending on the level of output the user has chosen (high or low). |

notextile. </div>

**_include/txp_admin.php_**

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @authors_deleted@ | - | After user(s) have been deleted and all assets have been reassigned. |  Passes an array of deleted user names as a parameter. |

notextile. </div>

**_include/txp_category.php_**

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @categories_deleted@ | - | After one or more categories have been deleted and the tree has been rebuilt. | Passes an array of deleted category IDs as a parameter. |

notextile. </div>

**_include/txp_css.php_**

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @css_deleted@ | - | After a stylesheet has been deleted. | Passes the name of the deleted stylesheet as a parameter. |

notextile. </div>

**_include/txp_discuss.php_**

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @discuss_deleted@ | - | After one or more comments have been deleted, but _before_ the comment counts have been updated in the affected articles. | Passes an array of the deleted comment IDs as a parameter. |

notextile. </div>

**_include/txp_file.php_**

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @file_deleted@ | - | Before each file is deleted. | First additional parameter is the file's ID. Second additional parameter is the full path to the file. |

notextile. </div>

**include/txp_form.php**

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @forms_deleted@ | - | After one or more forms have been deleted. | Passes an array of deleted form names as a parameter. |

notextile. </div>

**_include/txp_image.php_**

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @image_deleted@ | @image@ | Before an image and its thumbnail are deleted. | Passes the image ID  as a parameter |
| @image_uploaded@ | @image@ | After an image has been uploaded or replaced by another image. | Passes the image ID as a parameter. |

notextile. </div>

**_include/txp_link.php_**

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @links_deleted@ | - | After one or more links have been deleted. | Passes an array of deleted link IDs as a parameter. |

notextile. </div>

**_include/txp_list.php_**

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @articles_deleted@ | - | After one or more articles have been deleted and any associated comments have had their visibility removed. | Passes an array of deleted article IDs as a parameter. |

notextile. </div>

**_include/txp_page.php_**

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @page_deleted@ | - | After a page template has been deleted. | Passes the name of the deleted page as a parameter. |

notextile. </div>

**_include/txp_section.php_**

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. @$event@ |_. @$step@ |_. When it occurs |_. What it allows/does |
| @sections_deleted@ | - | After one or more sections have been deleted. | Passes an array of deleted section names as a parameter. |

notextile. </div>

h2(#sec5). Admin-side criteria callbacks

These callbacks allow you to alter the criteria used in the various panels. You can append SQL to the criteria to apply additional filtering. 

Note the criteria is _appended_, so existing search parameters are honoured. Therefore your returned statement should begin with @" AND ..."@. If you wish to ignore any previous filtering, begin @" AND 1 AND ..."@.

The third argument to your callback function contains the current criteria used so you may make decisions based on its contents (e.g., you may not want to filter the results if a search has been performed).

These callbacks all have the same @$event@ (= @admin_criteria@).

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. Panel |_. @$event@ |_. @$step@ |
| "Articles":http://docs.textpattern.io/administration/content/articles-panel | @admin_criteria@ | @list_list@ |
| "Comments":http://docs.textpattern.io/administration/content/comments-panel | " | discuss_list |
| "Files":http://docs.textpattern.io/administration/content/files-panel | " | @file_list@ |
| "Forms":http://docs.textpattern.io/administration/presentation/forms-panel | " | @form_list@ |
| "Images":http://docs.textpattern.io/administration/content/images-panel | " | @image_list@ |
| "Links":http://docs.textpattern.io/administration/content/links-panel | " | link_list |
| "Pages":http://docs.textpattern.io/administration/presentation/pages-panel | " | @page_list@ |
| "Sections":http://docs.textpattern.io/administration/presentation/sections-panel | @admin_criteria@ | @section_list@ |
| "Styles":http://docs.textpattern.io/administration/presentation/styles-panel | " | @css_list@ |
| "Users":http://docs.textpattern.io/administration/admin/users-panel | " | @author_list@ |
| "Visitor logs":http://docs.textpattern.io/administration/admin/visitor-logs-panel | " | @log_list@ |

notextile. </div>

h2(#sec6). Admin-side validation callbacks

These callbacks allow you to alter or append to the constraints imposed by the core when saving data. Textpattern will check that the passed values for things like categories, sections, and so forth actually exist in the database to avoid new ones being introduced at unexpected places.

Inside plugins, you may wish to open up or restrict data in certain types of actions, or create entirely new constraints and take advantage of the built-in validator. If so, these callbacks are the ones to use.

These additional arguments are all passed by reference to your application, so you can alter them directly:

* Argument #3 is the incoming array of values posted from the save operation, unsanitized. 
* Argument #4 is the array of constraints.

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. Panel |_. @$event@ |_. @$step@ |
| "Articles":http://docs.textpattern.io/administration/content/articles-panel | @article_ui@ | @validate_save@ |
| "Articles":http://docs.textpattern.io/administration/content/articles-panel | @article_ui@ | @validate_publish@ |
| "Comments":http://docs.textpattern.io/administration/content/comments-panel | @discuss_ui@ | @validate_save@ |
| "Files":http://docs.textpattern.io/administration/content/files-panel | @file_ui@ | @validate_save@ |
| "Images":http://docs.textpattern.io/administration/content/images-panel | @image_ui@ | @validate_save@ |
| "Links":http://docs.textpattern.io/administration/content/links-panel | @link_ui@ | @validate_save@ |

notextile. </div>

h2(#sec7). @pluggable_ui()@ callbacks

The @pluggable_ui()@ callbacks allow you to modify the admin-side panels Argument #1 passed to your function is the @$event@. Argument #2 is the @$step@. Arguments 3 and 4 (and occasionally 5) vary depending on the functionality of the UI component. In general, the following holds true unless otherwise stated:

* Argument #3 is the default markup.
* Argument #4 is the record set of the item that is being edited (if applicable).

Parsing argument #3 allows you to alter what was originally going to be displayed, and then return it. Or you may discard this markup and return your own instead.

h3. __include/txp_article.php__

For the **"Write":http://docs.textpattern.io/administration/content/write-panel** panel only. These callbacks all have the same @$event@ (= @article_ui@).

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. Panel |_. Concerned widget |_. @$event@ |_. @$step@ |_. What it alters or replaces |
| Write | - | @article_ui@ | @title@ | The **Title** field. |
| " | - | " | @body@ | The **Body** field. |
| " | - | " | @excerpt@ | The **Excerpt** field. |
| " | - | " | @view@ | The **View**, **HTML**, and **Preview** icon buttons. |
| " | - | " | @author@ | The _author_ and _published-at_ info. |
| " | **Advanced options** | " | @markup@ | The **Article markup** and **Excerpt markup** select lists. |
| " | **Advanced options** | " | @override@ | The **Override form** select list. |
| " | **Article image** | " | @article_image@ | And the **Article image** field. |
| " | **Comment options** | " | @annotate_invite@ | The **Off/On** and **Invitation** controls. |
| " | **Custom fields** | " | @custom_fields@ | And the contained fields. |
| " | **Date and time** | " | @timestamp@ | The **Timestamp** controls. |
| " | **Date and time** | " | @expires@ | The **Expires** controls.  |
| " | **Meta** | " | @keywords@ | The **Keywords** field. |
| " | **Meta** | " | @url_title@ | The **URL-only title** field. |
| " | **Recent articles** | " | @recent_articles@ | And the contained articles list. |
| " | **Sort and display** | " | @sort_display@ | The **Section** and **Category** select lists. |
| " | **Sort and display** | " | @section@ | The **Section** select list. |
| " | **Sort and display** | " | @categories@ | The **Category 1** and **Category 2** select lists. |
| " | **Status** | " | @status@ | And the contained radio buttons. |
| "" | **Textile help** | " | @sidehelp@ | And it's contents. |
| " | **Textile help** | " | @extend_col_1@ | Adds (not alters or replaces) markup below @sidehelp@. Argument #3 is empty as there is no default content here. |

Legend:

%(information)% = new in upcoming Textpattern 4.x.x.

notextile. </div>

**_include/txp_category.php_**

For the **"Categories":http://docs.textpattern.io/administration/content/categories-panel** panel.

notextile. <div class="tabular-data" itemscope itemtype="http://schema.org/Table">

|_. Panel |_. @$event@ |_. @$step@ |_. What it allows/does |
| Categories | @category_ui@ | @extend_detail_form@ | adds markup above the category _Save_ button when editing an individual category argument #3 is empty because there is no default content |

notextile. </div>

**_include/txp_image.php_**

For the **"Images":http://docs.textpattern.io/administration/content/images-panel** panel.

|_. Panel |_. @$event@ |_. @$step@ |_. What it allows/does |
| Images | @image_ui@ | @extend_controls@ | adds markup to the txp-control-panel area; argument #3 is empty because there is no default content |
| Images | @image_ui@ | @extend_detail_form@ | adds markup above the image **Save** button when editing an image argument #3 is empty because there is no default content |
| Images | @image_ui@ | @thumbnail@ | alters or replaces the thumbnail in the image list |
| Images | @image_ui@ | @fullsize_image@ | alters or replaces the main image in the image edit panel |
| Images | @image_ui@ | @image_edit@ | alters or replaces the area containing the upload (replace) image form |
| Images | @image_ui@ | @thumbnail_image@ | alters or replaces the thumbnail image in the image edit panel |
| Images | @image_ui@ | @thumbnail_edit@ | alters or replaces the area containing the thumbnail upload form |
| Images | @image_ui@ | @thumbnail_create@ | alters or replaces the 'thumbnail create' area containing the width / height input fields and crop checkbox |

notextile. </div>

h4(#files_panel_code_include_txp_filephp_code). Files panel (&lt;code&gt;include/txp_file.php&lt;/code&gt;)

*event = _file_ui_ step = _extend_detail_form_*
 allows you to add markup above the file _Save_ button when editing a file argument #3 is empty because there is no default content the same callback is used whether the file you are editing exists or is missing from the database  -  use the absence or availability of the 4th argument (record set) to determine which state the panel is in

h4(#links_panel_code_include_txp_linksphp_code). Links panel (&lt;code&gt;include/txp_links.php&lt;/code&gt;)

*event = _link_ui_ step = _extend_detail_form_*
 allows you to add markup above the link _Save_ button argument #3 is empty because there is no default content

h4(#sections_panel_code_include_txp_sectionphp_code). Sections panel (&lt;code&gt;include/txp_section.php&lt;/code&gt;)

*event = _section_ui_ step = _extend_detail_form_*
 allows you to add markup immediately above the _Save_ button in the _section edit_ panel argument #3 is empty because there is no default content the record set in argument #4 contains only the columns _page_ and _css_ when in the default area, and contains all columns at other times

h4(#users_panel_code_include_txp_adminphp_code). Users panel (&lt;code&gt;include/txp_admin.php&lt;/code&gt;)

*event = _author_ui_ step = _extend_detail_form_*
 allows you to add markup immediately above the author _Save_ button argument #3 is empty because there is no default content

h4(#preferences_panel_code_include_txp_prefsphp_code). Preferences panel (&lt;code&gt;include/txp_prefs.php&lt;/code&gt;)

*event = _prefs_ui_ step = _gmtoffset_*
 allows you to alter or replace the _Time zone_ select list (just the input control, not the label) argument #4 is the preference name in the txp_prefs table (_timezone_key_ in this case) argument #5 is the preference's value (i.e. the chosen item) *event = _prefs_ui_ step = _is_dst_*
 allows you to alter or replace the _DST enabled_ radio buttons (just the input control, not the label) argument #4 is the preference name in the txp_prefs table (_is_dst_ in this case) argument #5 is the preference's value (i.e. the numerical state of the radio button) *event = _prefs_ui_ step = _weeks_*
 allows you to alter or replace the _Comments disabled after_ select list (just the input control, not the label) argument #4 is the preference name in the txp_prefs table (_comments_disabled_after_ in this case) argument #5 is the preference's value (i.e. the numerical value of the selected item; in this case the number of days to keep commenting open) *event = _prefs_ui_ step = _custom_set_*
 allows you to alter or replace the Custom Field text boxes on the Advanced Prefs panel (just the input controls, not the labels). Each text box is called separately; you distinguish between them using argument #4 argument #4 is the preference name in the txp_prefs table (_custom_set_N_ by default, where _N_ is the custom field number) argument #5 is the preference's value (i.e. the name of the custom field) *event = _prefs_ui_ step = _theme_name_*
 allows you to alter or replace the _Admin theme_ select list on the Advanced Prefs panel (just the input control, not the label)

h2(#sec8). Theme callbacks

The following callbacks are all usable to alter various elements within admin-side themes.

h4(#code_lib_txplib_themephp_code). &lt;code&gt;lib/txplib_theme.php&lt;/code&gt;

*event = _admin_side_ step = _theme_name_*
 allows you to alter a theme's name when it is being initialised there is no argument #4

h4(#code_lib_txplib_headphp_code1). &lt;code&gt;lib/txplib_head.php&lt;/code&gt;

*event = _admin_side_ step = _header_*
 allows you to replace the standard pagetop header with something of your choosing. Theme authors do this by writing a

bc. header()


function in their theme's PHP file there is no argument #4

h4(#code_lib_txplib_htmlphp_code1). &lt;code&gt;lib/txplib_html.php&lt;/code&gt;

*event = _admin_side_ step = _footer_*
 allows you to replace the standard end_page footer with something of your choosing. Theme authors do this by writing a

bc. footer()


function in their theme's PHP file there is no spoon *event = _some_event_ui_ step = _upload_form_*
 allows you to alter or replace Textpattern's standard upload forms throughout the admin side _some_event_ is the name of the event on the panel upon which the input form appears (e.g. on the Files panel, the event is 'file' so the

bc. pluggable_ui()


event name is _file_ui_) argument #4 contains the remainder of the arguments to the

bc. upload_form()


function, i.e. 'label', 'pophelp', 'step', 'event', 'id', 'max_file_size', 'label_id' and 'class'.

