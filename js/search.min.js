function initSearch(){sessionStorage.getItem("lunrIndex")?getParameterByName("q")&&(q=decodeURIComponent(getParameterByName("q")),$searchInput.val(q),execSearch(q)):getData(),$(document).on("submit",$searchForm,function(a){a.preventDefault(),q=$searchInput.val(),execSearch(q)})}function getData(a){jqxhr=$.getJSON(jsonFeedUrl).done(function(b){sessionStorage.setItem("actualData",JSON.stringify(b)),a=lunr(function(){this.field("id"),this.field("title"),this.field("content",{boost:10}),this.field("author"),b.forEach(function(a,b){"true"!=a.search_omit&&(console.log("adding to index: "+a.title),this.add($.extend({id:b},a)))},this)}),sessionStorage.setItem("lunrIndex",JSON.stringify(a)),getParameterByName("q")&&(q=decodeURIComponent(getParameterByName("q")),$searchInput.val(q),execSearch(q))}).fail(function(){console.log("get json failed...")}).always(function(){console.log("finally...")})}function getResults(a){var b=JSON.parse(sessionStorage.getItem("lunrIndex"));return console.log("Indexed var from sessionStorage: "+b),lunr.Index.load(b).search(a)}function execSearch(a){(""!=a||allowEmpty)&&(showLoader&&toggleLoadingClass(),processResultData(getResults(a)))}function toggleLoadingClass(){$resultsPlaceholder.toggleClass(loadingClass),$foundContainer.toggleClass(loadingClass)}function processResultData(a){$results=[],console.log("Search Results: "+a);var b=0,c="";a.forEach(function(a){var d=JSON.parse(sessionStorage.getItem("actualData")),e=d[a.ref],a=populateResultContent($resultTemplate.html(),e);b++,c+=a}),showLoader&&toggleLoadingClass(),populateResultsString(b),showSearchResults(c)}function showSearchResults(a){$resultsPlaceholder.html(a)}function populateResultContent(a,b){return a=injectContent(a,b.title,"##Title##"),a=injectContent(a,b.link,"##Url##"),a=b.excerpt?injectContent(a,b.excerpt,"##Excerpt##"):injectContent(a,"","##Excerpt##"),a=b.date?injectContent(a,b.date,"##Date##"):injectContent(a,"","##Date##")}function populateResultsString(a){$foundTerm.text(q),$foundCount.text(a),$foundContainer.show()}function getParameterByName(a){var b=RegExp("[?&]"+a+"=([^&]*)").exec(window.location.search);return b&&decodeURIComponent(b[1].replace(/\+/g," "))}function injectContent(a,b,c){var d=new RegExp(c,"g");return a.replace(d,b)}var q,jsonFeedUrl="/feeds/feed.json",$searchForm=$("[data-search-form]"),$searchInput=$("[data-search-input]"),$resultTemplate=$("#search-result"),$resultsPlaceholder=$("[data-search-results]"),$foundContainer=$("[data-search-found]"),$foundTerm=$("[data-search-found-term]"),$foundCount=$("[data-search-found-count]"),allowEmpty=!0,showLoader=!0,loadingClass="is--loading",indexVar;$(document).ready(function(){$foundContainer.hide(),initSearch()});
