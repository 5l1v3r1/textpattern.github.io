var q,jsonFeedUrl="/feeds/feed.json",$searchForm=$("[data-search-form]"),$searchInput=$("[data-search-input]"),$resultTemplate=$("#search-result"),$resultsPlaceholder=$("[data-search-results]"),$foundContainer=$("[data-search-found]"),$foundTerm=$("[data-search-found-term]"),$foundCount=$("[data-search-found-count]"),allowEmpty=true,showLoader=true,loadingClass="is--loading",indexVar;$(document).ready(function(){$foundContainer.hide();initSearch()});function initSearch(){if(!sessionStorage.getItem("lunrIndex")){getData()}else{if(getParameterByName("q")){q=decodeURIComponent(getParameterByName("q"));$searchInput.val(q);execSearch(q)}}$(document).on("submit",$searchForm,function(a){a.preventDefault();q=$searchInput.val();execSearch(q)})}function getData(a){jqxhr=$.getJSON(jsonFeedUrl).done(function(b){sessionStorage.setItem("actualData",JSON.stringify(b));a=lunr(function(){this.field("id");this.field("title");this.field("content",{boost:10});this.field("author");b.forEach(function(d,c){if(d.search_omit!="true"){this.add($.extend({id:c},d))}},this)});sessionStorage.setItem("lunrIndex",JSON.stringify(a));if(getParameterByName("q")){q=decodeURIComponent(getParameterByName("q"));$searchInput.val(q);execSearch(q)}}).fail(function(){console.log("get json failed…")}).always(function(){console.log("finally…")})}function getResults(a){var b=JSON.parse(sessionStorage.getItem("lunrIndex"));return lunr.Index.load(b).search(a)}function execSearch(a){if(a!=""||allowEmpty){if(showLoader){toggleLoadingClass()}processResultData(getResults(a))}}function toggleLoadingClass(){$resultsPlaceholder.toggleClass(loadingClass);$foundContainer.toggleClass(loadingClass)}function processResultData(c){$results=[];var b=0,a="";c.forEach(function(e){var d=JSON.parse(sessionStorage.getItem("actualData"));var f=d[e.ref];var e=populateResultContent($resultTemplate.html(),f);b++;a+=e});if(showLoader){toggleLoadingClass()}populateResultsString(b);showSearchResults(a)}function showSearchResults(a){$resultsPlaceholder.html(a)}function populateResultContent(a,b){a=injectContent(a,b.title,"##Title##");a=injectContent(a,b.link,"##Url##");if(b.excerpt){a=injectContent(a,b.excerpt,"##Excerpt##")}else{a=injectContent(a,"","##Excerpt##")}if(b.date){a=injectContent(a,b.date,"##Date##")}else{a=injectContent(a,"","##Date##")}return a}function populateResultsString(a){if(typeof window.history.replaceState=="function"){history.replaceState({},"","?q="+encodeURIComponent(q))}$foundTerm.text(q);$foundCount.text(a);$foundContainer.show()}function getParameterByName(b){var a=RegExp("[?&]"+b+"=([^&]*)").exec(window.location.search);return a&&decodeURIComponent(a[1].replace(/\+/g," "))}function injectContent(a,b,d){var c=new RegExp(d,"g");return a.replace(c,b)};